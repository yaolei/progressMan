{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _objectSpread from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/evan/progressMan/src/components/BannerMng/BannerMng.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Form from './Form';\nimport Icon from 'components/Icon';\nimport LazyLoad from 'components/LazyLoad';\nimport isEqual from 'react-fast-compare';\nimport notdata from \"assets/images/nodata.svg\";\nimport './style/index.less'; // 预置columns\n\nvar columns = [{\n  title: '标题',\n  name: 'title',\n  formItem: {\n    rules: [{\n      required: true,\n      message: '请输入标题'\n    }, {\n      max: 300,\n      message: '标题最多能输入300个字符'\n    }, {\n      pattern: /^[\\w\\u4E00-\\u9FA5]+$/,\n      message: '标题只能输入英文字母、数字、汉字'\n    }]\n  }\n}, {\n  title: '链接',\n  name: 'link',\n  formItem: {\n    rules: [{\n      required: true,\n      message: '请输入链接'\n    }, {\n      max: 300,\n      message: '链接最多能输入300个字符'\n    }]\n  }\n}, {\n  title: '图片',\n  name: 'file',\n  formItem: {\n    type: 'upload',\n    listType: 'picture-card',\n    max: 1,\n    fileTypes: ['.png', '.jpg', '.gif'],\n    rules: [{\n      required: true,\n      message: '请上传图片'\n    }],\n    renderUpload: function renderUpload(a, b, isDisabled) {\n      return isDisabled ? null : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        type: \"plus\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"ant-upload-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67\n        },\n        __self: this\n      }, \"\\u4E0A\\u4F20\"));\n    }\n  }\n}];\n\nvar BannerMng =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(BannerMng, _Component);\n\n  function BannerMng(props) {\n    var _this;\n\n    _classCallCheck(this, BannerMng);\n\n    var formCols = props.formCols;\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(BannerMng).call(this, props));\n\n    _this.onEditBanner = function (item, editKey) {\n      _this.setState({\n        isEdit: editKey,\n        isAdd: false,\n        record: item\n      });\n    };\n\n    _this.onAddBanner = function () {\n      if (_this.props.fileNum && _this.props.fileNum > 0) {\n        if (_this.props.dataSource.length >= _this.props.fileNum) {\n          _message.error(\"\\u6700\\u591A\\u53EF\\u4EE5\\u6DFB\\u52A0\".concat(_this.props.fileNum, \"\\u5F20\\u56FE\\u7247\"));\n\n          return;\n        }\n      }\n\n      _this.setState({\n        isAdd: true,\n        isEdit: false,\n        record: null\n      });\n    };\n\n    _this.onCancel = function () {\n      _this.setState({\n        isAdd: false,\n        isEdit: false,\n        record: null\n      });\n    };\n\n    _this.onChange = function (type, item, i) {\n      var _this$state = _this.state,\n          dataSource = _this$state.dataSource,\n          isEdit = _this$state.isEdit;\n      var newState = {};\n\n      switch (type) {\n        case 'up':\n          dataSource.splice(i - 1, 0, dataSource.splice(i, 1)[0]);\n          break;\n\n        case 'down':\n          dataSource.splice(i + 1, 0, dataSource.splice(i, 1)[0]);\n          break;\n\n        case 'add':\n          newState.isAdd = false;\n          dataSource.push(item);\n          break;\n\n        case 'edit':\n          var tempIndex = -1;\n          var temp = dataSource.filter(function (data, index) {\n            if ('edit_' + index === isEdit) {\n              tempIndex = index;\n              return false;\n            }\n\n            return true;\n          });\n          temp.splice(tempIndex, 0, item);\n          dataSource = temp;\n          newState.isEdit = false;\n          break;\n\n        case 'delete':\n          dataSource.splice(i, 1);\n          break;\n\n        default:\n          break;\n      }\n\n      _this.setState(_objectSpread({\n        dataSource: dataSource\n      }, newState));\n\n      _this.props.onChange && _this.props.onChange(dataSource);\n    };\n\n    var imageKey = null;\n    formCols.forEach(function (item) {\n      if (item.formItem && item.formItem.type === 'upload') {\n        imageKey = item.name;\n      }\n    });\n    if (!imageKey) console.error(\"BannerMng required a column of type 'upload'\");\n    _this.state = {\n      isEdit: false,\n      isAdd: false,\n      record: null,\n      imageKey: imageKey,\n      dataSource: props.dataSource || []\n    };\n    return _this;\n  }\n\n  _createClass(BannerMng, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      var dataSource = nextProps.dataSource;\n\n      if (!isEqual(this.props.dataSource, dataSource)) {\n        this.setState({\n          dataSource: dataSource\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          formCols = _this$props.formCols,\n          title = _this$props.title;\n      var _this$state2 = this.state,\n          dataSource = _this$state2.dataSource,\n          record = _this$state2.record,\n          isEdit = _this$state2.isEdit,\n          isAdd = _this$state2.isAdd,\n          imageKey = _this$state2.imageKey;\n      return React.createElement(\"div\", {\n        className: \"banner-view-mng\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"banner-title clearfix\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        type: \"picture\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }), \" \", isEdit ? '修改' : isAdd ? '新增' : '', title), React.createElement(\"div\", {\n        className: \"btns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, !isAdd && !isEdit ? React.createElement(_Button, {\n        icon: \"plus\",\n        type: \"primary\",\n        onClick: this.onAddBanner,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, \"\\u65B0\\u589E\") : React.createElement(_Button, {\n        icon: \"rollback\",\n        onClick: this.onCancel,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, \"\\u8FD4\\u56DE\"))), isEdit || isAdd ? React.createElement(Form, {\n        imageKey: imageKey,\n        columns: formCols,\n        record: record,\n        onCancel: this.onCancel,\n        onSubmit: function onSubmit(values) {\n          return _this2.onChange(isEdit ? 'edit' : 'add', values);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }) : React.createElement(\"div\", {\n        className: \"banner-content clearfix\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, !dataSource.length ? React.createElement(\"div\", {\n        className: \"notdata\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: notdata,\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, \"~~\\u6CA1\\u6709\\u5185\\u5BB9~~\")) : null, dataSource.map(function (item, i) {\n        return React.createElement(\"div\", {\n          className: \"row\",\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 233\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"preview\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234\n          },\n          __self: this\n        }, React.createElement(LazyLoad, {\n          dataSrc: item[imageKey],\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 235\n          },\n          __self: this\n        })), React.createElement(\"ul\", {\n          className: \"oper\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 237\n          },\n          __self: this\n        }, React.createElement(\"li\", {\n          className: \"top\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238\n          },\n          __self: this\n        }, React.createElement(_Button, {\n          icon: \"caret-up\",\n          title: \"\\u4E0A\\u79FB\",\n          disabled: i === 0,\n          onClick: function onClick(e) {\n            return _this2.onChange('up', item, i);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239\n          },\n          __self: this\n        })), React.createElement(\"li\", {\n          className: \"bottom\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246\n          },\n          __self: this\n        }, React.createElement(_Button, {\n          icon: \"caret-down\",\n          title: \"\\u4E0B\\u79FB\",\n          disabled: i === dataSource.length - 1,\n          onClick: function onClick(e) {\n            return _this2.onChange('down', item, i);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 247\n          },\n          __self: this\n        })), React.createElement(\"li\", {\n          className: \"edit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 254\n          },\n          __self: this\n        }, React.createElement(_Button, {\n          icon: \"edit\",\n          title: \"\\u4FEE\\u6539\",\n          onClick: function onClick(e) {\n            return _this2.onEditBanner(item, 'edit_' + i);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 255\n          },\n          __self: this\n        })), React.createElement(\"li\", {\n          className: \"remove\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 261\n          },\n          __self: this\n        }, React.createElement(_Button, {\n          icon: \"close\",\n          title: \"\\u5220\\u9664\",\n          onClick: function onClick(e) {\n            return _this2.onChange('delete', item, i);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 262\n          },\n          __self: this\n        }))));\n      })));\n    }\n  }]);\n\n  return BannerMng;\n}(Component);\n\nBannerMng.propTypes = {\n  dataSource: PropTypes.array,\n  onChange: PropTypes.func,\n  fileNum: PropTypes.number,\n  fileSize: PropTypes.number,\n  fileType: PropTypes.array,\n  formCols: PropTypes.array,\n  title: PropTypes.node\n};\nBannerMng.defaultProps = {\n  formCols: columns,\n  title: '幻灯片'\n};\nexport default BannerMng;","map":{"version":3,"sources":["/Users/evan/progressMan/src/components/BannerMng/BannerMng.js"],"names":["React","Component","PropTypes","Form","Icon","LazyLoad","isEqual","columns","title","name","formItem","rules","required","message","max","pattern","type","listType","fileTypes","renderUpload","a","b","isDisabled","BannerMng","props","formCols","onEditBanner","item","editKey","setState","isEdit","isAdd","record","onAddBanner","fileNum","dataSource","length","error","onCancel","onChange","i","state","newState","splice","push","tempIndex","temp","filter","data","index","imageKey","forEach","console","nextProps","values","notdata","map","e","propTypes","array","func","number","fileSize","fileType","node","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, message } from 'antd';\nimport Form from './Form';\nimport Icon from 'components/Icon';\nimport LazyLoad from 'components/LazyLoad';\nimport isEqual from 'react-fast-compare';\nimport notdata from 'assets/images/nodata.svg';\nimport './style/index.less';\n\n// 预置columns\nconst columns = [\n  {\n    title: '标题',\n    name: 'title',\n    formItem: {\n      rules: [\n        {\n          required: true,\n          message: '请输入标题'\n        },\n        {\n          max: 300,\n          message: '标题最多能输入300个字符'\n        },\n        {\n          pattern: /^[\\w\\u4E00-\\u9FA5]+$/,\n          message: '标题只能输入英文字母、数字、汉字'\n        }\n      ]\n    }\n  },\n  {\n    title: '链接',\n    name: 'link',\n    formItem: {\n      rules: [\n        {\n          required: true,\n          message: '请输入链接'\n        },\n        {\n          max: 300,\n          message: '链接最多能输入300个字符'\n        }\n      ]\n    }\n  },\n  {\n    title: '图片',\n    name: 'file',\n    formItem: {\n      type: 'upload',\n      listType: 'picture-card',\n      max: 1,\n      fileTypes: ['.png', '.jpg', '.gif'],\n      rules: [\n        {\n          required: true,\n          message: '请上传图片'\n        }\n      ],\n      renderUpload: (a, b, isDisabled) =>\n        isDisabled ? null : (\n          <div>\n            <Icon type=\"plus\" />\n            <div className=\"ant-upload-text\">上传</div>\n          </div>\n        )\n    }\n  }\n];\n\nclass BannerMng extends Component {\n  static propTypes = {\n    dataSource: PropTypes.array,\n    onChange: PropTypes.func,\n    fileNum: PropTypes.number,\n    fileSize: PropTypes.number,\n    fileType: PropTypes.array,\n    formCols: PropTypes.array,\n    title: PropTypes.node\n  };\n\n  static defaultProps = {\n    formCols: columns,\n    title: '幻灯片'\n  };\n\n  constructor(props) {\n    const { formCols } = props;\n    super(props);\n\n    let imageKey = null;\n    formCols.forEach(item => {\n      if (item.formItem && item.formItem.type === 'upload') {\n        imageKey = item.name;\n      }\n    });\n    if (!imageKey)\n      console.error(\"BannerMng required a column of type 'upload'\");\n\n    this.state = {\n      isEdit: false,\n      isAdd: false,\n      record: null,\n      imageKey,\n      dataSource: props.dataSource || []\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { dataSource } = nextProps;\n    if (!isEqual(this.props.dataSource, dataSource)) {\n      this.setState({\n        dataSource\n      });\n    }\n  }\n\n  onEditBanner = (item, editKey) => {\n    this.setState({\n      isEdit: editKey,\n      isAdd: false,\n      record: item\n    });\n  };\n\n  onAddBanner = () => {\n    if (this.props.fileNum && this.props.fileNum > 0) {\n      if (this.props.dataSource.length >= this.props.fileNum) {\n        message.error(`最多可以添加${this.props.fileNum}张图片`);\n        return;\n      }\n    }\n\n    this.setState({\n      isAdd: true,\n      isEdit: false,\n      record: null\n    });\n  };\n\n  onCancel = () => {\n    this.setState({\n      isAdd: false,\n      isEdit: false,\n      record: null\n    });\n  };\n\n  onChange = (type, item, i) => {\n    let { dataSource, isEdit } = this.state;\n    const newState = {};\n    switch (type) {\n      case 'up':\n        dataSource.splice(i - 1, 0, dataSource.splice(i, 1)[0]);\n        break;\n      case 'down':\n        dataSource.splice(i + 1, 0, dataSource.splice(i, 1)[0]);\n        break;\n      case 'add':\n        newState.isAdd = false;\n        dataSource.push(item);\n        break;\n      case 'edit':\n        let tempIndex = -1;\n        let temp = dataSource.filter((data, index) => {\n          if ('edit_' + index === isEdit) {\n            tempIndex = index;\n            return false;\n          }\n          return true;\n        });\n        temp.splice(tempIndex, 0, item);\n        dataSource = temp;\n        newState.isEdit = false;\n        break;\n      case 'delete':\n        dataSource.splice(i, 1);\n        break;\n      default:\n        break;\n    }\n    this.setState({\n      dataSource,\n      ...newState\n    });\n\n    this.props.onChange && this.props.onChange(dataSource);\n  };\n\n  render() {\n    const { formCols, title } = this.props;\n    let { dataSource, record, isEdit, isAdd, imageKey } = this.state;\n\n    return (\n      <div className=\"banner-view-mng\">\n        <div className=\"banner-title clearfix\">\n          <div className=\"title\">\n            <Icon type=\"picture\" /> {isEdit ? '修改' : isAdd ? '新增' : ''}\n            {title}\n          </div>\n          <div className=\"btns\">\n            {!isAdd && !isEdit ? (\n              <Button icon=\"plus\" type=\"primary\" onClick={this.onAddBanner}>\n                新增\n              </Button>\n            ) : (\n              <Button icon=\"rollback\" onClick={this.onCancel}>\n                返回\n              </Button>\n            )}\n          </div>\n        </div>\n        {isEdit || isAdd ? (\n          <Form\n            imageKey={imageKey}\n            columns={formCols}\n            record={record}\n            onCancel={this.onCancel}\n            onSubmit={values => this.onChange(isEdit ? 'edit' : 'add', values)}\n          />\n        ) : (\n          <div className=\"banner-content clearfix\">\n            {!dataSource.length ? (\n              <div className=\"notdata\">\n                <img src={notdata} alt=\"\" />\n                <div>~~没有内容~~</div>\n              </div>\n            ) : null}\n            {dataSource.map((item, i) => (\n              <div className=\"row\" key={i}>\n                <div className=\"preview\">\n                  <LazyLoad dataSrc={item[imageKey]} />\n                </div>\n                <ul className=\"oper\">\n                  <li className=\"top\">\n                    <Button\n                      icon=\"caret-up\"\n                      title=\"上移\"\n                      disabled={i === 0}\n                      onClick={e => this.onChange('up', item, i)}\n                    />\n                  </li>\n                  <li className=\"bottom\">\n                    <Button\n                      icon=\"caret-down\"\n                      title=\"下移\"\n                      disabled={i === dataSource.length - 1}\n                      onClick={e => this.onChange('down', item, i)}\n                    />\n                  </li>\n                  <li className=\"edit\">\n                    <Button\n                      icon=\"edit\"\n                      title=\"修改\"\n                      onClick={e => this.onEditBanner(item, 'edit_' + i)}\n                    />\n                  </li>\n                  <li className=\"remove\">\n                    <Button\n                      icon=\"close\"\n                      title=\"删除\"\n                      onClick={e => this.onChange('delete', item, i)}\n                    />\n                  </li>\n                </ul>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default BannerMng;\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _classCallCheck from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"/Users/evan/progressMan/src/layouts/BasicLayout.js\";\n\nimport React from 'react';\nimport { connect } from 'dva';\nimport { Switch, routerRedux } from 'dva/router';\nimport NavBar from 'components/NavBar';\nimport { LeftSideBar, RightSideBar } from 'components/SideBar';\nimport TopBar from 'components/TopBar';\nimport SkinToolbox from 'components/SkinToolbox';\nimport pathToRegexp from 'path-to-regexp';\nimport { enquireIsMobile } from '@/utils/enquireScreen';\nimport TabsLayout from './TabsLayout';\nimport './styles/basic.less';\nimport $$ from 'cmn-utils';\nimport cx from 'classnames';\nvar Content = _Layout.Content,\n    Header = _Layout.Header;\n/**\n * 基本部局\n * 可设置多种皮肤 theme: [light, grey, primary, info, warning, danger, alert, system, success, dark]\n * 可设置多种布局 [header(固定头), sidebar(固定边栏), breadcrumb(固定面包蟹), tabLayout(标签布局)]\n * @author weiq\n */\n\nvar BasicLayout = (_dec = connect(function (_ref) {\n  var global = _ref.global;\n  return {\n    global: global\n  };\n}), _dec(_class = (_temp =\n/*#__PURE__*/\nfunction (_React$PureComponent) {\n  _inherits(BasicLayout, _React$PureComponent);\n\n  function BasicLayout(props) {\n    var _this;\n\n    _classCallCheck(this, BasicLayout);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(BasicLayout).call(this, props));\n\n    _this.getMeunMatchKeys = function (flatMenu, path) {\n      return flatMenu.filter(function (item) {\n        return pathToRegexp(item.path).test(path);\n      });\n    };\n\n    _this.onCollapseLeftSide = function (_) {\n      var collapsedLeftSide = _this.state.leftCollapsedWidth === 0 ? true : !_this.state.collapsedLeftSide;\n      var collapsedRightSide = _this.state.collapsedRightSide || !collapsedLeftSide;\n\n      _this.setState({\n        collapsedLeftSide: collapsedLeftSide,\n        collapsedRightSide: collapsedRightSide,\n        leftCollapsedWidth: 60\n      });\n    };\n\n    _this.onCollapseLeftSideAll = function (_) {\n      _this.setState({\n        collapsedLeftSide: true,\n        leftCollapsedWidth: 0\n      });\n    };\n\n    _this.onExpandTopBar = function (_) {\n      _this.setState({\n        expandTopBar: true\n      });\n    };\n\n    _this.onCollapseTopBar = function (_) {\n      _this.setState({\n        expandTopBar: false\n      });\n    };\n\n    _this.toggleSidebarHeader = function (_) {\n      _this.setState({\n        showSidebarHeader: !_this.state.showSidebarHeader\n      });\n    };\n\n    _this.toggleRightSide = function (_) {\n      var _this$state = _this.state,\n          collapsedLeftSide = _this$state.collapsedLeftSide,\n          collapsedRightSide = _this$state.collapsedRightSide;\n\n      _this.setState({\n        collapsedLeftSide: collapsedRightSide ? true : collapsedLeftSide,\n        collapsedRightSide: !collapsedRightSide\n      });\n    };\n\n    _this.onChangeTheme = function (theme) {\n      $$.setStore('theme', theme);\n\n      _this.setState({\n        theme: theme\n      });\n    };\n\n    var user = $$.getStore('user', []);\n\n    var _theme = $$.getStore('theme', {\n      leftSide: 'darkgrey',\n      // 左边\n      navbar: 'light' // 顶部\n\n    });\n\n    if (!_theme.layout) {\n      _theme.layout = ['fixedHeader', 'fixedSidebar', 'fixedBreadcrumbs' // 'hidedBreadcrumbs',\n      // 'tabLayout',\n      ];\n    }\n\n    _this.state = {\n      collapsedLeftSide: false,\n      // 左边栏开关控制\n      leftCollapsedWidth: 60,\n      // 左边栏宽度\n      expandTopBar: false,\n      // 头部多功能区开合\n      showSidebarHeader: false,\n      // 左边栏头部开关\n      collapsedRightSide: true,\n      // 右边栏开关\n      theme: _theme,\n      // 皮肤设置\n      user: user,\n      currentMenu: {},\n      isMobile: false\n    };\n    props.dispatch({\n      type: 'global/getMenu'\n    });\n    return _this;\n  }\n\n  _createClass(BasicLayout, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.unregisterEnquire = enquireIsMobile(function (ismobile) {\n        var _this2$state = _this2.state,\n            isMobile = _this2$state.isMobile,\n            theme = _this2$state.theme;\n\n        if (isMobile !== ismobile) {\n          // 如查是移动端则不固定侧边栏\n          if (ismobile && $$.isArray(theme.layout)) {\n            theme.layout = theme.layout.filter(function (item) {\n              return item !== 'fixedSidebar';\n            });\n          }\n\n          _this2.setState({\n            isMobile: ismobile\n          });\n        }\n      });\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      // 检查有户是否登录\n      var user = $$.getStore('user');\n\n      if (!user) {\n        this.props.dispatch(routerRedux.replace('/sign/login'));\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.location.pathname !== this.props.location.pathname || nextProps.global.flatMenu !== this.props.global.flatMenu) {\n        this.setState({\n          currentMenu: this.getCurrentMenu(nextProps) || {}\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // 清理监听\n      this.unregisterEnquire();\n    }\n  }, {\n    key: \"getCurrentMenu\",\n    value: function getCurrentMenu(props) {\n      var _ref2 = props || this.props,\n          pathname = _ref2.location.pathname,\n          global = _ref2.global;\n\n      var menu = this.getMeunMatchKeys(global.flatMenu, pathname)[0];\n      return menu;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          collapsedLeftSide = _this$state2.collapsedLeftSide,\n          leftCollapsedWidth = _this$state2.leftCollapsedWidth,\n          expandTopBar = _this$state2.expandTopBar,\n          showSidebarHeader = _this$state2.showSidebarHeader,\n          collapsedRightSide = _this$state2.collapsedRightSide,\n          theme = _this$state2.theme,\n          user = _this$state2.user,\n          currentMenu = _this$state2.currentMenu,\n          isMobile = _this$state2.isMobile;\n      var _this$props = this.props,\n          routerData = _this$props.routerData,\n          location = _this$props.location,\n          global = _this$props.global;\n      var menu = global.menu,\n          flatMenu = global.flatMenu;\n      var childRoutes = routerData.childRoutes;\n      var classnames = cx('basic-layout', 'full-layout', {\n        fixed: theme.layout && theme.layout.indexOf('fixedSidebar') !== -1,\n        'fixed-header': theme.layout && theme.layout.indexOf('fixedHeader') !== -1,\n        'fixed-breadcrumbs': theme.layout && theme.layout.indexOf('fixedBreadcrumbs') !== -1,\n        'hided-breadcrumbs': theme.layout && theme.layout.indexOf('hidedBreadcrumbs') !== -1\n      });\n      return React.createElement(_Layout, {\n        className: classnames,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }, React.createElement(NavBar, {\n        collapsed: collapsedLeftSide,\n        onCollapseLeftSide: this.onCollapseLeftSide,\n        onExpandTopBar: this.onExpandTopBar,\n        toggleSidebarHeader: this.toggleSidebarHeader,\n        theme: theme.navbar,\n        user: user,\n        isMobile: isMobile,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      })), React.createElement(_Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(LeftSideBar, {\n        collapsed: collapsedLeftSide,\n        leftCollapsedWidth: leftCollapsedWidth,\n        showHeader: showSidebarHeader,\n        onCollapse: this.onCollapseLeftSide,\n        onCollapseAll: this.onCollapseLeftSideAll,\n        location: location,\n        theme: theme.leftSide,\n        flatMenu: flatMenu,\n        currentMenu: currentMenu,\n        menu: menu,\n        user: user,\n        isMobile: isMobile,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }), React.createElement(Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, theme.layout.indexOf('tabLayout') >= 0 ? React.createElement(TabsLayout, {\n        childRoutes: childRoutes,\n        location: location,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }) : React.createElement(_Layout, {\n        className: \"full-layout\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, React.createElement(TopBar, {\n        expand: expandTopBar,\n        toggleRightSide: this.toggleRightSide,\n        collapsedRightSide: collapsedRightSide,\n        onCollapse: this.onCollapseTopBar,\n        currentMenu: currentMenu,\n        location: location,\n        theme: theme,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      })), React.createElement(Content, {\n        className: \"router-page\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, React.createElement(Switch, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255\n        },\n        __self: this\n      }, childRoutes)))), React.createElement(RightSideBar, {\n        collapsed: collapsedRightSide,\n        isMobile: isMobile,\n        onCollapse: this.toggleRightSide,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      })), React.createElement(SkinToolbox, {\n        onChangeTheme: this.onChangeTheme,\n        theme: theme,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return BasicLayout;\n}(React.PureComponent), _temp)) || _class);\nexport { BasicLayout as default };","map":{"version":3,"sources":["/Users/evan/progressMan/src/layouts/BasicLayout.js"],"names":["React","connect","Switch","routerRedux","NavBar","LeftSideBar","RightSideBar","TopBar","SkinToolbox","pathToRegexp","enquireIsMobile","TabsLayout","$$","cx","Content","Header","BasicLayout","global","props","getMeunMatchKeys","flatMenu","path","filter","item","test","onCollapseLeftSide","_","collapsedLeftSide","state","leftCollapsedWidth","collapsedRightSide","setState","onCollapseLeftSideAll","onExpandTopBar","expandTopBar","onCollapseTopBar","toggleSidebarHeader","showSidebarHeader","toggleRightSide","onChangeTheme","theme","setStore","user","getStore","leftSide","navbar","layout","currentMenu","isMobile","dispatch","type","unregisterEnquire","ismobile","isArray","replace","nextProps","location","pathname","getCurrentMenu","menu","routerData","childRoutes","classnames","fixed","indexOf","PureComponent"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,KAAxB;AAEA,SAASC,MAAT,EAAiBC,WAAjB,QAAoC,YAApC;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,SAASC,WAAT,EAAsBC,YAAtB,QAA0C,oBAA1C;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,SAASC,eAAT,QAAgC,uBAAhC;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAO,qBAAP;AACA,OAAOC,EAAP,MAAe,WAAf;AACA,OAAOC,EAAP,MAAe,YAAf;IACQC,O,WAAAA,O;IAASC,M,WAAAA,M;AAEjB;;;;;;;IAOqBC,W,WADpBf,OAAO,CAAC;AAAA,MAAGgB,MAAH,QAAGA,MAAH;AAAA,SAAiB;AAAEA,IAAAA,MAAM,EAANA;AAAF,GAAjB;AAAA,CAAD,C;;;;;AAEN,uBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,qFAAMA,KAAN;;AADiB,UAiFnBC,gBAjFmB,GAiFA,UAACC,QAAD,EAAWC,IAAX,EAAoB;AACrC,aAAOD,QAAQ,CAACE,MAAT,CAAgB,UAAAC,IAAI,EAAI;AAC7B,eAAOd,YAAY,CAACc,IAAI,CAACF,IAAN,CAAZ,CAAwBG,IAAxB,CAA6BH,IAA7B,CAAP;AACD,OAFM,CAAP;AAGD,KArFkB;;AAAA,UA0FnBI,kBA1FmB,GA0FE,UAAAC,CAAC,EAAI;AACxB,UAAMC,iBAAiB,GACrB,MAAKC,KAAL,CAAWC,kBAAX,KAAkC,CAAlC,GACI,IADJ,GAEI,CAAC,MAAKD,KAAL,CAAWD,iBAHlB;AAIA,UAAMG,kBAAkB,GACtB,MAAKF,KAAL,CAAWE,kBAAX,IAAiC,CAACH,iBADpC;;AAGA,YAAKI,QAAL,CAAc;AACZJ,QAAAA,iBAAiB,EAAjBA,iBADY;AAEZG,QAAAA,kBAAkB,EAAlBA,kBAFY;AAGZD,QAAAA,kBAAkB,EAAE;AAHR,OAAd;AAKD,KAvGkB;;AAAA,UA4GnBG,qBA5GmB,GA4GK,UAAAN,CAAC,EAAI;AAC3B,YAAKK,QAAL,CAAc;AACZJ,QAAAA,iBAAiB,EAAE,IADP;AAEZE,QAAAA,kBAAkB,EAAE;AAFR,OAAd;AAID,KAjHkB;;AAAA,UAsHnBI,cAtHmB,GAsHF,UAAAP,CAAC,EAAI;AACpB,YAAKK,QAAL,CAAc;AACZG,QAAAA,YAAY,EAAE;AADF,OAAd;AAGD,KA1HkB;;AAAA,UA+HnBC,gBA/HmB,GA+HA,UAAAT,CAAC,EAAI;AACtB,YAAKK,QAAL,CAAc;AACZG,QAAAA,YAAY,EAAE;AADF,OAAd;AAGD,KAnIkB;;AAAA,UAwInBE,mBAxImB,GAwIG,UAAAV,CAAC,EAAI;AACzB,YAAKK,QAAL,CAAc;AACZM,QAAAA,iBAAiB,EAAE,CAAC,MAAKT,KAAL,CAAWS;AADnB,OAAd;AAGD,KA5IkB;;AAAA,UAiJnBC,eAjJmB,GAiJD,UAAAZ,CAAC,EAAI;AAAA,wBAC6B,MAAKE,KADlC;AAAA,UACbD,iBADa,eACbA,iBADa;AAAA,UACMG,kBADN,eACMA,kBADN;;AAErB,YAAKC,QAAL,CAAc;AACZJ,QAAAA,iBAAiB,EAAEG,kBAAkB,GAAG,IAAH,GAAUH,iBADnC;AAEZG,QAAAA,kBAAkB,EAAE,CAACA;AAFT,OAAd;AAID,KAvJkB;;AAAA,UAyJnBS,aAzJmB,GAyJH,UAAAC,KAAK,EAAI;AACvB5B,MAAAA,EAAE,CAAC6B,QAAH,CAAY,OAAZ,EAAqBD,KAArB;;AACA,YAAKT,QAAL,CAAc;AACZS,QAAAA,KAAK,EAALA;AADY,OAAd;AAGD,KA9JkB;;AAEjB,QAAME,IAAI,GAAG9B,EAAE,CAAC+B,QAAH,CAAY,MAAZ,EAAoB,EAApB,CAAb;;AACA,QAAMH,MAAK,GAAG5B,EAAE,CAAC+B,QAAH,CAAY,OAAZ,EAAqB;AACjCC,MAAAA,QAAQ,EAAE,UADuB;AACX;AACtBC,MAAAA,MAAM,EAAE,OAFyB,CAEjB;;AAFiB,KAArB,CAAd;;AAIA,QAAI,CAACL,MAAK,CAACM,MAAX,EAAmB;AACjBN,MAAAA,MAAK,CAACM,MAAN,GAAe,CACb,aADa,EAEb,cAFa,EAGb,kBAHa,CAIb;AACA;AALa,OAAf;AAOD;;AACD,UAAKlB,KAAL,GAAa;AACXD,MAAAA,iBAAiB,EAAE,KADR;AACe;AAC1BE,MAAAA,kBAAkB,EAAE,EAFT;AAEa;AACxBK,MAAAA,YAAY,EAAE,KAHH;AAGU;AACrBG,MAAAA,iBAAiB,EAAE,KAJR;AAIe;AAC1BP,MAAAA,kBAAkB,EAAE,IALT;AAKe;AAC1BU,MAAAA,KAAK,EAALA,MANW;AAMJ;AACPE,MAAAA,IAAI,EAAJA,IAPW;AAQXK,MAAAA,WAAW,EAAE,EARF;AASXC,MAAAA,QAAQ,EAAE;AATC,KAAb;AAYA9B,IAAAA,KAAK,CAAC+B,QAAN,CAAe;AACbC,MAAAA,IAAI,EAAE;AADO,KAAf;AA5BiB;AA+BlB;;;;wCAEmB;AAAA;;AAClB,WAAKC,iBAAL,GAAyBzC,eAAe,CAAC,UAAA0C,QAAQ,EAAI;AAAA,2BACvB,MAAI,CAACxB,KADkB;AAAA,YAC3CoB,QAD2C,gBAC3CA,QAD2C;AAAA,YACjCR,KADiC,gBACjCA,KADiC;;AAEnD,YAAIQ,QAAQ,KAAKI,QAAjB,EAA2B;AACzB;AACA,cAAIA,QAAQ,IAAIxC,EAAE,CAACyC,OAAH,CAAWb,KAAK,CAACM,MAAjB,CAAhB,EAA0C;AACxCN,YAAAA,KAAK,CAACM,MAAN,GAAeN,KAAK,CAACM,MAAN,CAAaxB,MAAb,CAAoB,UAAAC,IAAI;AAAA,qBAAIA,IAAI,KAAK,cAAb;AAAA,aAAxB,CAAf;AACD;;AACD,UAAA,MAAI,CAACQ,QAAL,CAAc;AACZiB,YAAAA,QAAQ,EAAEI;AADE,WAAd;AAGD;AACF,OAXuC,CAAxC;AAYD;;;yCAEoB;AACnB;AACA,UAAMV,IAAI,GAAG9B,EAAE,CAAC+B,QAAH,CAAY,MAAZ,CAAb;;AACA,UAAI,CAACD,IAAL,EAAW;AACT,aAAKxB,KAAL,CAAW+B,QAAX,CAAoB9C,WAAW,CAACmD,OAAZ,CAAoB,aAApB,CAApB;AACD;AACF;;;8CAEyBC,S,EAAW;AACnC,UACEA,SAAS,CAACC,QAAV,CAAmBC,QAAnB,KAAgC,KAAKvC,KAAL,CAAWsC,QAAX,CAAoBC,QAApD,IACAF,SAAS,CAACtC,MAAV,CAAiBG,QAAjB,KAA8B,KAAKF,KAAL,CAAWD,MAAX,CAAkBG,QAFlD,EAGE;AACA,aAAKW,QAAL,CAAc;AACZgB,UAAAA,WAAW,EAAE,KAAKW,cAAL,CAAoBH,SAApB,KAAkC;AADnC,SAAd;AAGD;AACF;;;2CAEsB;AACrB;AACA,WAAKJ,iBAAL;AACD;;;mCAEcjC,K,EAAO;AAAA,kBAIhBA,KAAK,IAAI,KAAKA,KAJE;AAAA,UAENuC,QAFM,SAElBD,QAFkB,CAENC,QAFM;AAAA,UAGlBxC,MAHkB,SAGlBA,MAHkB;;AAKpB,UAAM0C,IAAI,GAAG,KAAKxC,gBAAL,CAAsBF,MAAM,CAACG,QAA7B,EAAuCqC,QAAvC,EAAiD,CAAjD,CAAb;AACA,aAAOE,IAAP;AACD;;;6BAiFQ;AAAA,yBAWH,KAAK/B,KAXF;AAAA,UAELD,iBAFK,gBAELA,iBAFK;AAAA,UAGLE,kBAHK,gBAGLA,kBAHK;AAAA,UAILK,YAJK,gBAILA,YAJK;AAAA,UAKLG,iBALK,gBAKLA,iBALK;AAAA,UAMLP,kBANK,gBAMLA,kBANK;AAAA,UAOLU,KAPK,gBAOLA,KAPK;AAAA,UAQLE,IARK,gBAQLA,IARK;AAAA,UASLK,WATK,gBASLA,WATK;AAAA,UAULC,QAVK,gBAULA,QAVK;AAAA,wBAYkC,KAAK9B,KAZvC;AAAA,UAYC0C,UAZD,eAYCA,UAZD;AAAA,UAYaJ,QAZb,eAYaA,QAZb;AAAA,UAYuBvC,MAZvB,eAYuBA,MAZvB;AAAA,UAaC0C,IAbD,GAaoB1C,MAbpB,CAaC0C,IAbD;AAAA,UAaOvC,QAbP,GAaoBH,MAbpB,CAaOG,QAbP;AAAA,UAcCyC,WAdD,GAciBD,UAdjB,CAcCC,WAdD;AAeP,UAAMC,UAAU,GAAGjD,EAAE,CAAC,cAAD,EAAiB,aAAjB,EAAgC;AACnDkD,QAAAA,KAAK,EAAEvB,KAAK,CAACM,MAAN,IAAgBN,KAAK,CAACM,MAAN,CAAakB,OAAb,CAAqB,cAArB,MAAyC,CAAC,CADd;AAEnD,wBACExB,KAAK,CAACM,MAAN,IAAgBN,KAAK,CAACM,MAAN,CAAakB,OAAb,CAAqB,aAArB,MAAwC,CAAC,CAHR;AAInD,6BACExB,KAAK,CAACM,MAAN,IAAgBN,KAAK,CAACM,MAAN,CAAakB,OAAb,CAAqB,kBAArB,MAA6C,CAAC,CALb;AAMnD,6BACExB,KAAK,CAACM,MAAN,IAAgBN,KAAK,CAACM,MAAN,CAAakB,OAAb,CAAqB,kBAArB,MAA6C,CAAC;AAPb,OAAhC,CAArB;AAUA,aACE;AAAQ,QAAA,SAAS,EAAEF,UAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AACE,QAAA,SAAS,EAAEnC,iBADb;AAEE,QAAA,kBAAkB,EAAE,KAAKF,kBAF3B;AAGE,QAAA,cAAc,EAAE,KAAKQ,cAHvB;AAIE,QAAA,mBAAmB,EAAE,KAAKG,mBAJ5B;AAKE,QAAA,KAAK,EAAEI,KAAK,CAACK,MALf;AAME,QAAA,IAAI,EAAEH,IANR;AAOE,QAAA,QAAQ,EAAEM,QAPZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,EAYE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,WAAD;AACE,QAAA,SAAS,EAAErB,iBADb;AAEE,QAAA,kBAAkB,EAAEE,kBAFtB;AAGE,QAAA,UAAU,EAAEQ,iBAHd;AAIE,QAAA,UAAU,EAAE,KAAKZ,kBAJnB;AAKE,QAAA,aAAa,EAAE,KAAKO,qBALtB;AAME,QAAA,QAAQ,EAAEwB,QANZ;AAOE,QAAA,KAAK,EAAEhB,KAAK,CAACI,QAPf;AAQE,QAAA,QAAQ,EAAExB,QARZ;AASE,QAAA,WAAW,EAAE2B,WATf;AAUE,QAAA,IAAI,EAAEY,IAVR;AAWE,QAAA,IAAI,EAAEjB,IAXR;AAYE,QAAA,QAAQ,EAAEM,QAZZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAeE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGR,KAAK,CAACM,MAAN,CAAakB,OAAb,CAAqB,WAArB,KAAqC,CAArC,GACC,oBAAC,UAAD;AAAY,QAAA,WAAW,EAAEH,WAAzB;AAAsC,QAAA,QAAQ,EAAEL,QAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD,GAGC;AAAQ,QAAA,SAAS,EAAC,aAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AACE,QAAA,MAAM,EAAEtB,YADV;AAEE,QAAA,eAAe,EAAE,KAAKI,eAFxB;AAGE,QAAA,kBAAkB,EAAER,kBAHtB;AAIE,QAAA,UAAU,EAAE,KAAKK,gBAJnB;AAKE,QAAA,WAAW,EAAEY,WALf;AAME,QAAA,QAAQ,EAAES,QANZ;AAOE,QAAA,KAAK,EAAEhB,KAPT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,EAYE,oBAAC,OAAD;AAAS,QAAA,SAAS,EAAC,aAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAASqB,WAAT,CADF,CAZF,CAJJ,CAfF,EAqCE,oBAAC,YAAD;AACE,QAAA,SAAS,EAAE/B,kBADb;AAEE,QAAA,QAAQ,EAAEkB,QAFZ;AAGE,QAAA,UAAU,EAAE,KAAKV,eAHnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QArCF,CAZF,EAuDE,oBAAC,WAAD;AAAa,QAAA,aAAa,EAAE,KAAKC,aAAjC;AAAgD,QAAA,KAAK,EAAEC,KAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAvDF,CADF;AA2DD;;;;EArPsCxC,KAAK,CAACiE,a;SAA1BjD,W","sourcesContent":["import React from 'react';\nimport { connect } from 'dva';\nimport { Layout } from 'antd';\nimport { Switch, routerRedux } from 'dva/router';\nimport NavBar from 'components/NavBar';\nimport { LeftSideBar, RightSideBar } from 'components/SideBar';\nimport TopBar from 'components/TopBar';\nimport SkinToolbox from 'components/SkinToolbox';\nimport pathToRegexp from 'path-to-regexp';\nimport { enquireIsMobile } from '@/utils/enquireScreen';\nimport TabsLayout from './TabsLayout';\nimport './styles/basic.less';\nimport $$ from 'cmn-utils';\nimport cx from 'classnames';\nconst { Content, Header } = Layout;\n\n/**\n * 基本部局\n * 可设置多种皮肤 theme: [light, grey, primary, info, warning, danger, alert, system, success, dark]\n * 可设置多种布局 [header(固定头), sidebar(固定边栏), breadcrumb(固定面包蟹), tabLayout(标签布局)]\n * @author weiq\n */\n@connect(({ global }) => ({ global }))\nexport default class BasicLayout extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const user = $$.getStore('user', []);\n    const theme = $$.getStore('theme', {\n      leftSide: 'darkgrey', // 左边\n      navbar: 'light' // 顶部\n    });\n    if (!theme.layout) {\n      theme.layout = [\n        'fixedHeader',\n        'fixedSidebar',\n        'fixedBreadcrumbs'\n        // 'hidedBreadcrumbs',\n        // 'tabLayout',\n      ];\n    }\n    this.state = {\n      collapsedLeftSide: false, // 左边栏开关控制\n      leftCollapsedWidth: 60, // 左边栏宽度\n      expandTopBar: false, // 头部多功能区开合\n      showSidebarHeader: false, // 左边栏头部开关\n      collapsedRightSide: true, // 右边栏开关\n      theme, // 皮肤设置\n      user,\n      currentMenu: {},\n      isMobile: false\n    };\n\n    props.dispatch({\n      type: 'global/getMenu'\n    });\n  }\n\n  componentDidMount() {\n    this.unregisterEnquire = enquireIsMobile(ismobile => {\n      const { isMobile, theme } = this.state;\n      if (isMobile !== ismobile) {\n        // 如查是移动端则不固定侧边栏\n        if (ismobile && $$.isArray(theme.layout)) {\n          theme.layout = theme.layout.filter(item => item !== 'fixedSidebar');\n        }\n        this.setState({\n          isMobile: ismobile\n        });\n      }\n    });\n  }\n\n  componentWillMount() {\n    // 检查有户是否登录\n    const user = $$.getStore('user');\n    if (!user) {\n      this.props.dispatch(routerRedux.replace('/sign/login'));\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.location.pathname !== this.props.location.pathname ||\n      nextProps.global.flatMenu !== this.props.global.flatMenu\n    ) {\n      this.setState({\n        currentMenu: this.getCurrentMenu(nextProps) || {}\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    // 清理监听\n    this.unregisterEnquire();\n  }\n\n  getCurrentMenu(props) {\n    const {\n      location: { pathname },\n      global\n    } = props || this.props;\n    const menu = this.getMeunMatchKeys(global.flatMenu, pathname)[0];\n    return menu;\n  }\n\n  getMeunMatchKeys = (flatMenu, path) => {\n    return flatMenu.filter(item => {\n      return pathToRegexp(item.path).test(path);\n    });\n  };\n\n  /**\n   * 顶部左侧菜单图标收缩控制\n   */\n  onCollapseLeftSide = _ => {\n    const collapsedLeftSide =\n      this.state.leftCollapsedWidth === 0\n        ? true\n        : !this.state.collapsedLeftSide;\n    const collapsedRightSide =\n      this.state.collapsedRightSide || !collapsedLeftSide;\n\n    this.setState({\n      collapsedLeftSide,\n      collapsedRightSide,\n      leftCollapsedWidth: 60\n    });\n  };\n\n  /**\n   * 完全关闭左边栏，即宽为0\n   */\n  onCollapseLeftSideAll = _ => {\n    this.setState({\n      collapsedLeftSide: true,\n      leftCollapsedWidth: 0\n    });\n  };\n\n  /**\n   * 展开面包屑所在条中的多功能区\n   */\n  onExpandTopBar = _ => {\n    this.setState({\n      expandTopBar: true\n    });\n  };\n\n  /**\n   * 与上面相反\n   */\n  onCollapseTopBar = _ => {\n    this.setState({\n      expandTopBar: false\n    });\n  };\n\n  /**\n   * 切换左边栏中头部的开合\n   */\n  toggleSidebarHeader = _ => {\n    this.setState({\n      showSidebarHeader: !this.state.showSidebarHeader\n    });\n  };\n\n  /**\n   * 切换右边栏\n   */\n  toggleRightSide = _ => {\n    const { collapsedLeftSide, collapsedRightSide } = this.state;\n    this.setState({\n      collapsedLeftSide: collapsedRightSide ? true : collapsedLeftSide,\n      collapsedRightSide: !collapsedRightSide\n    });\n  };\n\n  onChangeTheme = theme => {\n    $$.setStore('theme', theme);\n    this.setState({\n      theme\n    });\n  };\n\n  render() {\n    const {\n      collapsedLeftSide,\n      leftCollapsedWidth,\n      expandTopBar,\n      showSidebarHeader,\n      collapsedRightSide,\n      theme,\n      user,\n      currentMenu,\n      isMobile\n    } = this.state;\n    const { routerData, location, global } = this.props;\n    const { menu, flatMenu } = global;\n    const { childRoutes } = routerData;\n    const classnames = cx('basic-layout', 'full-layout', {\n      fixed: theme.layout && theme.layout.indexOf('fixedSidebar') !== -1,\n      'fixed-header':\n        theme.layout && theme.layout.indexOf('fixedHeader') !== -1,\n      'fixed-breadcrumbs':\n        theme.layout && theme.layout.indexOf('fixedBreadcrumbs') !== -1,\n      'hided-breadcrumbs':\n        theme.layout && theme.layout.indexOf('hidedBreadcrumbs') !== -1\n    });\n\n    return (\n      <Layout className={classnames}>\n        <Header>\n          <NavBar\n            collapsed={collapsedLeftSide}\n            onCollapseLeftSide={this.onCollapseLeftSide}\n            onExpandTopBar={this.onExpandTopBar}\n            toggleSidebarHeader={this.toggleSidebarHeader}\n            theme={theme.navbar}\n            user={user}\n            isMobile={isMobile}\n          />\n        </Header>\n        <Layout>\n          <LeftSideBar\n            collapsed={collapsedLeftSide}\n            leftCollapsedWidth={leftCollapsedWidth}\n            showHeader={showSidebarHeader}\n            onCollapse={this.onCollapseLeftSide}\n            onCollapseAll={this.onCollapseLeftSideAll}\n            location={location}\n            theme={theme.leftSide}\n            flatMenu={flatMenu}\n            currentMenu={currentMenu}\n            menu={menu}\n            user={user}\n            isMobile={isMobile}\n          />\n          <Content>\n            {theme.layout.indexOf('tabLayout') >= 0 ? (\n              <TabsLayout childRoutes={childRoutes} location={location} />\n            ) : (\n              <Layout className=\"full-layout\">\n                <Header>\n                  <TopBar\n                    expand={expandTopBar}\n                    toggleRightSide={this.toggleRightSide}\n                    collapsedRightSide={collapsedRightSide}\n                    onCollapse={this.onCollapseTopBar}\n                    currentMenu={currentMenu}\n                    location={location}\n                    theme={theme}\n                  />\n                </Header>\n                <Content className=\"router-page\">\n                  <Switch>{childRoutes}</Switch>\n                </Content>\n              </Layout>\n            )}\n          </Content>\n          <RightSideBar\n            collapsed={collapsedRightSide}\n            isMobile={isMobile}\n            onCollapse={this.toggleRightSide}\n          />\n        </Layout>\n        <SkinToolbox onChangeTheme={this.onChangeTheme} theme={theme} />\n      </Layout>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}
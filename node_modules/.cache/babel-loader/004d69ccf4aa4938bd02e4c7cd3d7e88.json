{"ast":null,"code":"import _objectWithoutProperties from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _classCallCheck from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/evan/progressMan/src/components/Form/model/editor.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Editor from '../../Editor';\nimport $$ from 'cmn-utils';\nimport omit from 'object.omit';\n\nvar EditorControlled =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EditorControlled, _Component);\n\n  function EditorControlled(props) {\n    var _this;\n\n    _classCallCheck(this, EditorControlled);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditorControlled).call(this, props));\n\n    _this.triggerChange = function (value) {\n      var onChange = _this.props.onChange;\n\n      if (onChange) {\n        onChange(value);\n      }\n    };\n\n    var _value = props.value;\n    _this.state = {\n      value: _value\n    };\n    return _this;\n  }\n\n  _createClass(EditorControlled, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      var value = nextProps.value;\n\n      if (this.props.value !== value) {\n        this.setState({\n          value: value\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var value = this.state.value;\n      var otherProps = omit(this.props, 'value');\n      return React.createElement(Editor, Object.assign({\n        value: value,\n        onChange: this.triggerChange\n      }, otherProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return EditorControlled;\n}(Component);\n/**\n * EditorForm组件\n */\n\n\nEditorControlled.propTypes = {\n  value: PropTypes.string,\n  onChange: PropTypes.func\n};\nexport default (function (_ref) {\n  var form = _ref.form,\n      name = _ref.name,\n      _ref$formFieldOptions = _ref.formFieldOptions,\n      formFieldOptions = _ref$formFieldOptions === void 0 ? {} : _ref$formFieldOptions,\n      record = _ref.record,\n      initialValue = _ref.initialValue,\n      rules = _ref.rules,\n      onChange = _ref.onChange,\n      normalize = _ref.normalize,\n      preview = _ref.preview,\n      getPopupContainer = _ref.getPopupContainer,\n      otherProps = _objectWithoutProperties(_ref, [\"form\", \"name\", \"formFieldOptions\", \"record\", \"initialValue\", \"rules\", \"onChange\", \"normalize\", \"preview\", \"getPopupContainer\"]);\n\n  var getFieldDecorator = form.getFieldDecorator;\n  var initval = initialValue;\n\n  if (record) {\n    initval = record[name];\n  } // 如果存在初始值\n\n\n  if (initval !== null && typeof initval !== 'undefined') {\n    if ($$.isFunction(normalize)) {\n      formFieldOptions.initialValue = normalize(initval);\n    } else {\n      formFieldOptions.initialValue = initval;\n    }\n  }\n\n  if (preview) {\n    return React.createElement(\"div\", {\n      style: otherProps.style,\n      dangerouslySetInnerHTML: {\n        __html: initval || ''\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80\n      },\n      __self: this\n    });\n  } // 如果有rules\n\n\n  if (rules && rules.length) {\n    formFieldOptions.rules = rules;\n  } // 如果需要onChange\n\n\n  if (typeof onChange === 'function') {\n    formFieldOptions.onChange = function (value) {\n      return onChange(form, value);\n    }; // form, value\n\n  }\n\n  return getFieldDecorator(name, formFieldOptions)(React.createElement(EditorControlled, Object.assign({}, otherProps, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  })));\n});","map":{"version":3,"sources":["/Users/evan/progressMan/src/components/Form/model/editor.js"],"names":["React","Component","PropTypes","Editor","$$","omit","EditorControlled","props","triggerChange","value","onChange","state","nextProps","setState","otherProps","propTypes","string","func","form","name","formFieldOptions","record","initialValue","rules","normalize","preview","getPopupContainer","getFieldDecorator","initval","isFunction","style","__html","length"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Editor from '../../Editor';\nimport $$ from 'cmn-utils';\nimport omit from 'object.omit';\n\nclass EditorControlled extends Component {\n  static propTypes = {\n    value: PropTypes.string,\n    onChange: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n    const { value } = props;\n    this.state = {\n      value\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { value } = nextProps;\n    if (this.props.value !== value) {\n      this.setState({ value });\n    }\n  }\n\n  triggerChange = value => {\n    const onChange = this.props.onChange;\n    if (onChange) {\n      onChange(value);\n    }\n  };\n\n  render() {\n    const { value } = this.state;\n    const otherProps = omit(this.props, 'value');\n\n    return (\n      <Editor value={value} onChange={this.triggerChange} {...otherProps} />\n    );\n  }\n}\n\n/**\n * EditorForm组件\n */\nexport default ({\n  form,\n  name,\n  formFieldOptions = {},\n  record,\n  initialValue,\n  rules,\n  onChange,\n  normalize,\n  preview,\n  getPopupContainer,\n  ...otherProps\n}) => {\n  const { getFieldDecorator } = form;\n\n  let initval = initialValue;\n\n  if (record) {\n    initval = record[name];\n  }\n\n  // 如果存在初始值\n  if (initval !== null && typeof initval !== 'undefined') {\n    if ($$.isFunction(normalize)) {\n      formFieldOptions.initialValue = normalize(initval);\n    } else {\n      formFieldOptions.initialValue = initval;\n    }\n  }\n\n  if (preview) {\n    return (\n      <div\n        style={otherProps.style}\n        dangerouslySetInnerHTML={{ __html: initval || '' }}\n      />\n    );\n  }\n\n  // 如果有rules\n  if (rules && rules.length) {\n    formFieldOptions.rules = rules;\n  }\n\n  // 如果需要onChange\n  if (typeof onChange === 'function') {\n    formFieldOptions.onChange = value => onChange(form, value); // form, value\n  }\n\n  return getFieldDecorator(name, formFieldOptions)(\n    <EditorControlled {...otherProps} />\n  );\n};\n"]},"metadata":{},"sourceType":"module"}
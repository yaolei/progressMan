{"ast":null,"code":"import _regeneratorRuntime from \"/Users/evan/progressMan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport modelEnhance from '@/utils/modelEnhance';\nimport PageHelper from '@/utils/pageHelper';\n/**\n * 当第一次加载完页面时为true\n * 可以用这个值阻止切换页面时\n * 多次初始化数据\n */\n\nvar LOADED = false;\nexport default modelEnhance({\n  namespace: 'crud',\n  state: {\n    pageData: PageHelper.create(),\n    employees: []\n  },\n  subscriptions: {\n    setup: function setup(_ref) {\n      var dispatch = _ref.dispatch,\n          history = _ref.history;\n      history.listen(function (_ref2) {\n        var pathname = _ref2.pathname;\n\n        if (pathname === '/crud' && !LOADED) {\n          LOADED = true;\n          dispatch({\n            type: 'init'\n          });\n        }\n      });\n    }\n  },\n  effects: {\n    // 进入页面加载\n    init:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function init(_ref3, _ref4) {\n      var payload, call, put, select, _ref5, pageData;\n\n      return _regeneratorRuntime.wrap(function init$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              payload = _ref3.payload;\n              call = _ref4.call, put = _ref4.put, select = _ref4.select;\n              _context.next = 4;\n              return select(function (state) {\n                return state.crud;\n              });\n\n            case 4:\n              _ref5 = _context.sent;\n              pageData = _ref5.pageData;\n              _context.next = 8;\n              return put({\n                type: 'getPageInfo',\n                payload: {\n                  pageData: pageData.startPage(1, 10)\n                }\n              });\n\n            case 8:\n              _context.next = 10;\n              return put({\n                type: 'getEmployees'\n              });\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, init);\n    }),\n    // 获取分页数据\n    getPageInfo:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function getPageInfo(_ref6, _ref7) {\n      var payload, call, put, pageData;\n      return _regeneratorRuntime.wrap(function getPageInfo$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              payload = _ref6.payload;\n              call = _ref7.call, put = _ref7.put;\n              pageData = payload.pageData;\n              _context2.next = 5;\n              return put({\n                type: '@request',\n                payload: {\n                  valueField: 'pageData',\n                  url: '/crud/getList',\n                  pageInfo: pageData\n                }\n              });\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, getPageInfo);\n    }),\n    // 保存 之后查询分页\n    save:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function save(_ref8, _ref9) {\n      var payload, call, put, select, take, values, success, _ref10, pageData;\n\n      return _regeneratorRuntime.wrap(function save$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              payload = _ref8.payload;\n              call = _ref9.call, put = _ref9.put, select = _ref9.select, take = _ref9.take;\n              values = payload.values, success = payload.success;\n              _context3.next = 5;\n              return select(function (state) {\n                return state.crud;\n              });\n\n            case 5:\n              _ref10 = _context3.sent;\n              pageData = _ref10.pageData;\n              _context3.next = 9;\n              return put({\n                type: '@request',\n                payload: {\n                  notice: true,\n                  url: '/crud/save',\n                  data: values\n                }\n              });\n\n            case 9:\n              _context3.next = 11;\n              return take('@request/@@end');\n\n            case 11:\n              _context3.next = 13;\n              return put({\n                type: 'getPageInfo',\n                payload: {\n                  pageData: pageData\n                }\n              });\n\n            case 13:\n              success();\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, save);\n    }),\n    // 修改\n    update:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function update(_ref11, _ref12) {\n      var payload, call, put;\n      return _regeneratorRuntime.wrap(function update$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              payload = _ref11.payload;\n              call = _ref12.call, put = _ref12.put;\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, update);\n    }),\n    // 删除 之后查询分页\n    remove:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function remove(_ref13, _ref14) {\n      var payload, call, put, select, records, success, _ref15, pageData;\n\n      return _regeneratorRuntime.wrap(function remove$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              payload = _ref13.payload;\n              call = _ref14.call, put = _ref14.put, select = _ref14.select;\n              records = payload.records, success = payload.success;\n              _context5.next = 5;\n              return select(function (state) {\n                return state.crud;\n              });\n\n            case 5:\n              _ref15 = _context5.sent;\n              pageData = _ref15.pageData;\n              _context5.next = 9;\n              return put({\n                type: '@request',\n                payload: {\n                  notice: true,\n                  url: '/crud/bathDelete',\n                  data: records.map(function (item) {\n                    return item.rowKey;\n                  })\n                }\n              });\n\n            case 9:\n              _context5.next = 11;\n              return put({\n                type: 'getPageInfo',\n                payload: {\n                  pageData: pageData\n                }\n              });\n\n            case 11:\n              success();\n\n            case 12:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, remove);\n    }),\n    // 获取员工列表\n    getEmployees:\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function getEmployees(_ref16, _ref17) {\n      var payload, call, put;\n      return _regeneratorRuntime.wrap(function getEmployees$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              payload = _ref16.payload;\n              call = _ref17.call, put = _ref17.put;\n              _context6.next = 4;\n              return put({\n                type: '@request',\n                afterResponse: function afterResponse(resp) {\n                  return resp.data;\n                },\n                payload: {\n                  valueField: 'employees',\n                  url: '/crud/getWorkEmployee'\n                }\n              });\n\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, getEmployees);\n    })\n  },\n  reducers: {}\n});","map":{"version":3,"sources":["/Users/evan/progressMan/src/routes/Business/CRUD/model/index.js"],"names":["modelEnhance","PageHelper","LOADED","namespace","state","pageData","create","employees","subscriptions","setup","dispatch","history","listen","pathname","type","effects","init","payload","call","put","select","crud","startPage","getPageInfo","valueField","url","pageInfo","save","take","values","success","notice","data","update","remove","records","map","item","rowKey","getEmployees","afterResponse","resp","reducers"],"mappings":"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","sourcesContent":["import modelEnhance from '@/utils/modelEnhance';\nimport PageHelper from '@/utils/pageHelper';\n/**\n * 当第一次加载完页面时为true\n * 可以用这个值阻止切换页面时\n * 多次初始化数据\n */\nlet LOADED = false;\nexport default modelEnhance({\n  namespace: 'crud',\n\n  state: {\n    pageData: PageHelper.create(),\n    employees: []\n  },\n\n  subscriptions: {\n    setup({ dispatch, history }) {\n      history.listen(({ pathname }) => {\n        if (pathname === '/crud' && !LOADED) {\n          LOADED = true;\n          dispatch({\n            type: 'init'\n          });\n        }\n      });\n    }\n  },\n\n  effects: {\n    // 进入页面加载\n    *init({ payload }, { call, put, select }) {\n      const { pageData } = yield select(state => state.crud);\n      yield put({\n        type: 'getPageInfo',\n        payload: {\n          pageData: pageData.startPage(1, 10)\n        }\n      });\n      yield put({\n        type: 'getEmployees'\n      });\n    },\n    // 获取分页数据\n    *getPageInfo({ payload }, { call, put }) {\n      const { pageData } = payload;\n      yield put({\n        type: '@request',\n        payload: {\n          valueField: 'pageData',\n          url: '/crud/getList',\n          pageInfo: pageData\n        }\n      });\n    },\n    // 保存 之后查询分页\n    *save({ payload }, { call, put, select, take }) {\n      const { values, success } = payload;\n      const { pageData } = yield select(state => state.crud);\n      yield put({\n        type: '@request',\n        payload: {\n          notice: true,\n          url: '/crud/save',\n          data: values\n        }\n      });\n      // 等待@request结束\n      yield take('@request/@@end');\n      yield put({\n        type: 'getPageInfo',\n        payload: { pageData }\n      });\n      success();\n    },\n    // 修改\n    *update({ payload }, { call, put }) {},\n    // 删除 之后查询分页\n    *remove({ payload }, { call, put, select }) {\n      const { records, success } = payload;\n      const { pageData } = yield select(state => state.crud);\n      yield put({\n        type: '@request',\n        payload: {\n          notice: true,\n          url: '/crud/bathDelete',\n          data: records.map(item => item.rowKey)\n        }\n      });\n      yield put({\n        type: 'getPageInfo',\n        payload: { pageData }\n      });\n      success();\n    },\n    // 获取员工列表\n    *getEmployees({ payload }, { call, put }) {\n      yield put({\n        type: '@request',\n        afterResponse: resp => resp.data,\n        payload: {\n          valueField: 'employees',\n          url: '/crud/getWorkEmployee'\n        }\n      });\n    }\n  },\n\n  reducers: {}\n});\n"]},"metadata":{},"sourceType":"module"}
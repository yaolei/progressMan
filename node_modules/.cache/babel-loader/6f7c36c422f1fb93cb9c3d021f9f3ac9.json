{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _keys = require('babel-runtime/core-js/object/keys');\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends6 = require('babel-runtime/helpers/extends');\n\nvar _extends7 = _interopRequireDefault(_extends6);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar SHOW = '@@DVA_LOADING/SHOW';\nvar HIDE = '@@DVA_LOADING/HIDE';\nvar NAMESPACE = 'loading';\n\nfunction createLoading() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var namespace = opts.namespace || NAMESPACE;\n  var initialState = {\n    global: false,\n    models: {},\n    effects: {}\n  };\n  var extraReducers = (0, _defineProperty3.default)({}, namespace, function () {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n    var _ref = arguments[1];\n    var type = _ref.type,\n        payload = _ref.payload;\n\n    var _ref2 = payload || {},\n        namespace = _ref2.namespace,\n        actionType = _ref2.actionType;\n\n    var ret = void 0;\n\n    switch (type) {\n      case SHOW:\n        ret = (0, _extends7.default)({}, state, {\n          global: true,\n          models: (0, _extends7.default)({}, state.models, (0, _defineProperty3.default)({}, namespace, true)),\n          effects: (0, _extends7.default)({}, state.effects, (0, _defineProperty3.default)({}, actionType, true))\n        });\n        break;\n\n      case HIDE:\n        // eslint-disable-line\n        var effects = (0, _extends7.default)({}, state.effects, (0, _defineProperty3.default)({}, actionType, false));\n        var models = (0, _extends7.default)({}, state.models, (0, _defineProperty3.default)({}, namespace, (0, _keys2.default)(effects).some(function (actionType) {\n          var _namespace = actionType.split('/')[0];\n          if (_namespace !== namespace) return false;\n          return effects[actionType];\n        })));\n        var global = (0, _keys2.default)(models).some(function (namespace) {\n          return models[namespace];\n        });\n        ret = (0, _extends7.default)({}, state, {\n          global: global,\n          models: models,\n          effects: effects\n        });\n        break;\n\n      default:\n        ret = state;\n        break;\n    }\n\n    return ret;\n  });\n\n  function onEffect(effect, _ref3, model, actionType) {\n    var put = _ref3.put;\n    var namespace = model.namespace;\n    return (\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee() {\n        var _args = arguments;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return put({\n                  type: SHOW,\n                  payload: {\n                    namespace: namespace,\n                    actionType: actionType\n                  }\n                });\n\n              case 2:\n                _context.next = 4;\n                return effect.apply(undefined, _args);\n\n              case 4:\n                _context.next = 6;\n                return put({\n                  type: HIDE,\n                  payload: {\n                    namespace: namespace,\n                    actionType: actionType\n                  }\n                });\n\n              case 6:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      })\n    );\n  }\n\n  return {\n    extraReducers: extraReducers,\n    onEffect: onEffect\n  };\n}\n\nexports.default = createLoading;\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}